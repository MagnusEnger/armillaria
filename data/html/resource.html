<!DOCTYPE html>
<html>
	<head>
		<script src="/public/js/ractive.js"></script>
		<script src='/public/js/ractive-events-keys.js'></script>
		<script src="/public/js/underscore-min.js"></script>
		<meta charset=utf-8 />
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>opprett/endre ressurs</title>
		<link href="/public/css/normalize.css" media="all" rel="stylesheet" type="text/css" />
		<link href="/public/css/styles.css" media="screen" rel="stylesheet" type="text/css" />
	</head>

	<body>
		<div class="container" id="app">
			<script id='template' type='text/ractive'>
				<div class="resourceMenu">
					<button disabled='true'>Innhent data fra eksterne ressurser</button>
  				<button on-click="saveDraft" disabled='{{draftDisabled}}'>
						{{^overview.published}}Lagre kladd{{/overview.published}}
						{{#overview.published}}Trekk tilbake til kladd{{/overview.published}}
					</button>
  					<button on-click="publish" disabled='{{publishDisabled}}'>
							{{^overview.published}}Publisér{{/overview.published}}
							{{#overview.published}}Lagre{{/overview.published}}
						</button>
					{{#existingResource}}
						<button on-click="delResource" disabled='{{deleteDisabled}}'>Slett</button>
					{{/existingResource}}
				</div>
				<div class="RDFProfile">

					<h2>{{overview.title}}</h2>
					<p class="grey monospace">{{overview.type}}</p>
					<p>{{overview.desc}}</p>

					<div class="resourceMetadata">
						<div class="resourceURI">
							<label>URI:</label> <span>{{overview.uri}}</span>
							{{#duplicateURI}}
								<span class="errorInfo">denne URIen finnes fra før!</span>
							{{/duplicateURI}}
							{{#changedURI}}
								<span class="errorInfo">NB: URIen for ressursen er endret</span>
								<br/>
								<label>Gammel URI:</label> <span>{{existingURI}}</span></label>
							{{/changedURI}}
						</div>
						<div class="row clearfix resourceTimestamps">
							{{#existingResource}}
							<div class="column third">
								<label>Opprettet</label><br/>
								<input disabled=true value="{{overview.created}}" />
							</div>
							<div class="column third">
								<label>Publisert</label><br/>
								<input disabled=true value="{{overview.published}}" />
							</div>
							<div class="column third">
								<label>Sist endret</label><br/>
								<input disabled=true value="{{overview.updated}}" />
							</div>
							{{/existingResource}}
							<div class="column third">
								<label>Søkebetegnelse</label><br/>
								<input disabled=true value="{{overview.searchLabel}}" />
							</div>
							<div class="column third">
								<label>Visningsbetegnelse</label><br/>
								<input disabled=true value="{{overview.displayLabel}}" />
							</div>
						</div>
					</div>

					{{#views:i1}}
					<div class="resourceData">
						<h3>{{title}}</h3>
						<p>{{desc}}</p>

						{{#elements:i2}}

							<h4 class="relative">{{label}}
								{{#required}}<span class="indicator2 red">*</span>{{/}}
								{{#repeatable}}<span class="indicator grey">+</span>{{/}}
								{{#generated}}<span class="indicator2 grey">a</span>{{/}}
							</h4>

							{{^ generated}}

								{{# type === 'URI' }}
									{{>URIInput}}
								{{/}}

								{{# type === 'float'}}
									{{>floatInput}}
								{{/}}

								{{# type == 'integer' }}
									{{>integerInput}}
								{{/}}

								{{# type == 'gYear' }}
									{{>gYearInput}}
								{{/}}


								{{# type == 'langString'}}
									{{>langStringInput}}
								{{/}}

								{{# type == 'string' }}
									{{>stringInput}}
								{{/}}

								{{# type == 'selectMust'}}
									{{>selectMustInput}}
								{{/}}

								{{# type == 'select'}}
									{{>selectInput}}
								{{/}}

							{{/generated}}

							<div class="propertyDesc">{{desc}}</div>

							<div class="clearfix row resourceValues">
							{{^ type == 'selectMust'}}
								{{#values:i3}}
									<div class="propertyValue column third">

										{{^URILabel}}<span class="propertyLabel clickable" on-click="editLiteral">{{value}}</span>{{/URILabel}}
										{{#URILabel}}<span class="propertyLabel">{{value}}</span>{{/URILabel}}
										<span class="removeProperty" on-click='remove'>&times;</span>
										{{# source !== 'local' }}
											<span class="tinyText">{{source}}</span>
										{{/}}
										{{#URILabel}}
											<div><strong>{{URILabel}}</strong></div>
										{{/URILabel}}
									</div>
								{{/values}}
							{{/}}

							</div>

						{{/elements}}
					</div>
					{{/views}}
				</div>
				<!-- {{>URIInput}} -->
					<input
						on-keyup='searchForURI'
						on-blur='searchBlur'
						placeholder="søk etter ressurs"/>
					{{#searching}}
						<div class="relative">
							<div class="URISearchResults">
								<ul>
								{{#searchResults}}
									<li class="searchHit" on-click='selectURI'>
										<span class="hitLabel">{{_source.displayLabel}}</span>
										<span class="hitURI grey">{{_source.uri}}</span>
									</li>
								{{/searchResults}}
								{{^searchResults}} (ingen treff) {{/searchResults}}
								</ul>
								<strong>Opprett ny ressurs: </strong>
								{{#searchTypes}}<a class='newResLink' target='_blank' href='/resource?profile={{.}}'>{{.}}</a>{{/searchTypes}}
							</div>
						</div>
					{{/}}
				<!-- {{/URIInput}} -->

				<!-- {{>floatInput}} -->
						<input id="{{id}}"
						  value='{{currentValue}}'
							on-enter='validateFloat'
							disabled={{# repeatable == false && values}}true{{/}}
							placeholder="{{# repeatable == false && values}}kun én verdi tillatt{{/}}"/>
							<span class="errorInfo">{{errorInfo}}</span>
				<!-- {{/floatInput}} -->

				<!-- {{>integerInput}} -->
						<input id="{{id}}"
						  value={{currentValue}}
							on-enter='validateInteger'
							disabled={{# repeatable == false && values}}true{{/}}
							placeholder="{{# repeatable == false && values}}kun én verdi tillatt{{/}}"/>
							<span class="errorInfo">{{errorInfo}}</span>
				<!-- {{/integerInput}} -->

				<!-- {{>gYearInput}} -->
						<input id="{{id}}"
						  value={{currentValue}}
							on-enter='validateGYear'
							disabled={{# repeatable == false && values}}true{{/}}
							placeholder="{{# repeatable == false && values}}kun én verdi tillatt{{/}}"/>
							<span class="errorInfo">{{errorInfo}}</span>
				<!-- {{/gYearInput}} -->

				<!-- {{>langStringInput}} -->
						<input id="{{id}}"
						  value={{currentValue}}
							on-enter='validateLangString'
							disabled={{# repeatable == false && values}}true{{/}}
							placeholder="{{# repeatable == false && values}}kun én verdi tillatt{{/}}"/>
							<span class="errorInfo">{{errorInfo}}</span>
							<select class="langTagSelect" value={{.selectedLang}}>
								{{#languages}}
									<option value={{value}}>{{label}}</option>
								{{/languages}}
							</select>
				<!-- {{/langStringInput}} -->

				<!-- {{>stringInput}} -->
						<input id="{{id}}"
						  value={{currentValue}}
							on-enter='validateString'
							disabled={{# repeatable == false && values}}true{{/}}
							placeholder="{{# repeatable == false && values}}kun én verdi tillatt{{/}}"/>
							<span class="errorInfo">{{errorInfo}}</span>
				<!-- {{/stringInput}} -->
				<!-- {{>selectMustInput}} -->
						<select class="valSelect" value={{values[0].value}} on-change="selectOption">
							{{# options}}
								<option value={{value}}>{{URILabel || value}}</option>
							{{/options}}
						</select>
						<span class="errorInfo">{{errorInfo}}</span>
				<!-- {{/selectMustInput}} -->
				<!-- {{>selectInput}} -->
						<select
							disabled={{# repeatable == false && values}}true{{/}}
							class="valSelect" value={{.selected}}>
							{{# options}}
								<option value={{value}}>{{URILabel || value}}</option>
							{{/options}}
						</select>
						<button class="smallButton monospace" on-click="selectAddOption">Legg til</button>
						<span class="errorInfo">{{errorInfo}}</span>
				<!-- {{/selectInput}} -->
			</script>
		</div>
		<script src="/public/profiles/_common.js"></script>
		<script src="/public/js/resource.js"></script>
	</body>
</html>
